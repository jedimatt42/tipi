
{% extends "page_template.html"%}
{% block content %}

<script>
function checkFields(f) {
    if (f.upload_file.value == '') {
       alert("Please select a file from your computer to upload to TIPI");
       f.upload_file.focus();
       
       return false;
    }

    f.uploadFileSubmit.value = ' Uploading, Please Wait ... ';
    f.uploadFileSubmit.disabled = true;
}

function getSelectAction(form) {
  form.action = "/" + document.getElementById("select-op").value;
}

function newDirOnClick() {
  document.getElementById('newBasicFileForm').style.display='none';
  document.getElementById('uploadForm').style.display='none';

  document.getElementById('newDirForm').style.display='block';
  document.getElementById('newDir').focus();
}

function newFileOnClick() {
  document.getElementById('newDirForm').style.display='none';
  document.getElementById('uploadForm').style.display='none';

  document.getElementById('newBasicFileForm').style.display='block';
  document.getElementById('file').focus();
}

function uploadOnClick() {
  document.getElementById('newDirForm').style.display='none';
  document.getElementById('newBasicFileForm').style.display='none';

  document.getElementById('uploadForm').style.display='block';
  document.getElementById('selectfiles').focus();
}

</script>

<div class="files_container">
<div class="alert alert-info" role="alert">
    
</div>



<p><b>Drive Mapping</b></p>

<div class="drive-mappings">

<div class="drive-assignment" style="order: 1;">
  <span>DSK1. =</span> 
  {% if config.get("DSK1_DIR") %}
  <form method=post action="/unmapdsk1">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK1_URL") }}">{{ config.get("DSK1_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

<div class="drive-assignment" style="order: 3;">
  <span>DSK2. =</span>
  {% if config.get("DSK2_DIR") %}
  <form method=post action="/unmapdsk2">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK2_URL") }}">{{ config.get("DSK2_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

<div class="drive-assignment" style="order: 5;">
  <span>DSK3. =</span>
  {% if config.get("DSK3_DIR") %}
  <form method=post action="/unmapdsk3">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK3_URL") }}">{{ config.get("DSK3_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

<div class="drive-assignment" style="order: 7;">
  <span>DSK4. =</span>
  {% if config.get("DSK4_DIR") %}
  <form method=post action="/unmapdsk4">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK4_URL") }}">{{ config.get("DSK4_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

<div class="drive-assignment" style="order: 9;">
  <span>DSK5. =</span>
  {% if config.get("DSK5_DIR") %}
  <form method=post action="/unmapdsk5">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK5_URL") }}">{{ config.get("DSK5_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

<div class="drive-assignment" style="order: 2;">
  <span>DSK6. =</span>
  {% if config.get("DSK6_DIR") %}
  <form method=post action="/unmapdsk6">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK6_URL") }}">{{ config.get("DSK6_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

<div class="drive-assignment" style="order: 4;">
  <span>DSK7. =</span>
  {% if config.get("DSK7_DIR") %}
  <form method=post action="/unmapdsk7">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK7_URL") }}">{{ config.get("DSK7_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

<div class="drive-assignment" style="order: 6;">
  <span>DSK8. =</span>
  {% if config.get("DSK8_DIR") %}
  <form method=post action="/unmapdsk8">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK8_URL") }}">{{ config.get("DSK8_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

<div class="drive-assignment" style="order: 8;">
  <span>DSK9. =</span>
  {% if config.get("DSK9_DIR") %}
  <form method=post action="/unmapdsk9">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("DSK9_URL") }}">{{ config.get("DSK9_DIR") }}</a>
      <button type="submit" title="Remove Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% endif %}
</div>

</div>

<div class="drive-assignment">
  <span>CS1 File =</span>
  {% if config.get("CS1_FILE") %}
  <form method=post action="/unmapcs1">
      <input type=hidden name="path" value="{{ display_path }}" />
      <a href="{{ config.get("CS1_URL") }}">{{ config.get("CS1_FILE") }}</a>
      <button type="submit" title="Remove File Mapping" class="tool_button">
	  <img src="/images/delete.webp" height="10px"/>
      </button> 
  </form>
  {% else %}
  <form method=post action="/mapcs1">
      <input type=hidden name="path" value="{{ display_path }}" />
      <input type="text" id="cs1_input" name="cs1_input" value="{{ config.get('CS1_FILE') }}" />
      <button type="submit" title="Save CS1 File Mapping">Save</button> 
  </form>
  {% endif %}
</div>

<div class="file-summary">
  <div>Displaying contents of &nbsp;
  {% for item in tipi_path %}
    <a href="{{ item.get("link") }}">{{ item.get("label") }}</a>.
  {% endfor %}   
  </div>
  <div>Total files: {{ total_files }} </div>
  <div>Free Space: {{ free_space }} </div>
</div>

<table cellspacing=4 cellpadding=0 border=0 width="80%">
    <tr>
        <td colspan=9 align="right">
            <div id="newDirForm" style="display:none">
                <form method=post action="/newdir">
                    <input type=hidden name="path" value="{{ display_path }}">
                    <input type="text" id="newDir" size=32 name="newdir" placeholder="New Dir">
                    <input type=submit value="Create Dir">
                </form>
            </div>
            <div id="newBasicFileForm" style="display:none">
                <form method=post action="/new_basic_file">
                    <input type=hidden name="path" value="{{ display_path }}">
                    <input type="text" id="file" size=32 name="file" placeholder="New BASIC Filename">
                    <input type=submit value="Create File">
                </form>
            </div>
            <div id="uploadForm" style="display:none">
                <form name="f" action="/uploadFile" method=post enctype="multipart/form-data" onSubmit="return checkFields(this);">
                    <input type=hidden name="path" value="{{ display_path }}">
                    <input type="file" id="selectfiles" name="upload_file" onClick="f.uploadFileSubmit.value=' Upload ';f.uploadFileSubmit.disabled=false;" multiple=""> 
                    <input name="uploadFileSubmit" id="uploadFileSubmit" type=submit value="Upload">
                </form>
            </div>
            <button id="newDirButton" title="new directory" 
                   onClick="newDirOnClick();" class="tool_button">
                <img src="/images/new_folder_icon.png" height="30px"/>
            </button> 
            <button id="newBasicFileButton" title="new BASIC file"
                   onClick="newFileOnClick();" class="tool_button">
                <img src="/images/new_file_icon.png" height="30px"/>
            </button>
            <button id="uploadFileButton" title="uploads files"
                   onClick="uploadOnClick();" class="tool_button">
                <img src="/images/upload_icon.png" height="30px"/>
            </button>
            <a href="{{ request.path }}">
                <button id="refresh" title="refresh" class="tool_button">
                    <img src="/images/refresh_icon.png" height="30px"/>
                </button>
            </a>
        </td> 
    </tr>
</table>

  <form id="select-form" method="post" onsubmit="getSelectAction(this);">
    <input type=hidden name="path" value="{{ display_path }}">

    <select id="select-op" name="operation">
      <option value="">Select Action</option>
      <option value="delete">Delete</option>
      <option value="tifiles">Convert v9t9 to TIFILES</option>
      <option value="mapdsk1">Map to DSK1</option>
      <option value="mapdsk2">Map to DSK2</option>
      <option value="mapdsk3">Map to DSK3</option>
      <option value="mapdsk4">Map to DSK4</option>
      <option value="mapdsk5">Map to DSK5</option>
      <option value="mapdsk6">Map to DSK6</option>
      <option value="mapdsk7">Map to DSK7</option>
      <option value="mapdsk8">Map to DSK8</option>
      <option value="mapdsk9">Map to DSK9</option>
      <option value="mapcs1">Map File to CS1</option>
    </select>
    <input type="submit" value="Submit"/>

    <div class="filelistheadings">
      <div class="files-select"><!-- checkbox --></div>
      <div class="files-icon"><!-- icon --></div>
      <div class="files-filename">filename</div>
      <div class="files-type">type</div>
      <div class="files-size">size</div>
      <div class="files-timestamp">datestamp</div>
      <div class="files-icon"></div>
      <div class="files-icon"></div>
      <div class="files-nativename">native name</div>
    </div>

{% for tipi_file in tipi_dir_listing %}
  <div class="filelistrow">
    <div class="files-select"> <input type="checkbox" name="selected" value="{{ tipi_file.name }}"/> </div>
    <div class="files-icon"> {{ tipi_file.icon|safe }} </div>
    <div class="files-filename"> {{ tipi_file.name|safe }} </div>
    <div class="files-type"> {{ tipi_file.type }} </div>
    {% if tipi_file.type == "DIR" and tipi_file.mapname in mapped.keys() %}
    <div class="mapname"> {{ mapped.get(tipi_file.mapname) }} </div>
    {% else %}
    <div class="files-size"> {{ tipi_file.size }} </div>
    {% endif %}
    <div class="files-timestamp"> {{ tipi_file.date }} </div>
    <div class="files-icon"> {{ tipi_file.edit_link|safe }} </div>
    <div class="files-icon"> {{ tipi_file.dl_link|safe }} </div>
    <div class="files-nativename"> {%- if tipi_file.longname -%} {{ tipi_file.longname|safe }} {% endif %} </div>
  </div>
{% endfor %}

</form>
</div>


<BR><BR>  

{% endblock %}



